graph TD
    A["AMF: Send IDENTITY REQUEST, Start T3570"] --> B{"UE: Receive IDENTITY REQUEST"};
    B -- "Identity Type != SUCI" --> C["UE: Send IDENTITY RESPONSE (Parameters)"];
    B -- "Identity Type == SUCI" --> D{"T3519 Running?"};
    D -- "No" --> E["UE: Generate Fresh SUCI, Send IDENTITY RESPONSE (SUCI), Start T3519, Store SUCI"];
    D -- "Yes" --> F["UE: Send IDENTITY RESPONSE (Stored SUCI)"];
    C --> G["AMF: Receive IDENTITY RESPONSE, Stop T3570"];
    F --> G;
    G --> H["Procedure Complete"];
    subgraph "Abnormal Cases (UE)"
        I["Transmission Failure of IDENTITY RESPONSE (triggered by Registration)"] --> J["UE: Re-initiate Registration"];
        K["Requested Identity Not Available"] --> L["UE: Encode Identity Type as 'No Identity'"];
    end;
    subgraph "Abnormal Cases (Network)"
        M["Lower Layer Failure"] --> N["Network: Abort any ongoing 5GMM procedure"];
        O["Expiry of T3570"] --> P{"Retransmission Count < 4?"};
        P -- "Yes" --> Q["Network: Retransmit IDENTITY REQUEST, Reset and Restart T3570"];
        P -- "No" --> R["Network: Abort Identification Procedure, Abort any ongoing 5GMM procedure"];
    end